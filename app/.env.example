###############################################################################
# APP / ENVIRONMENT
###############################################################################
# Ambiente da aplicação:
# - dev  => desenvolvimento local
# - hml  => homologação/staging
# - prod => produção
APP_ENV=dev

# Log level (trace | debug | info | warn | error | fatal)
LOG_LEVEL=info

# Express host (bind)
APP_HOST=127.0.0.1

# Express port
APP_PORT=8080

# Quantos proxies existem imediatamente na frente do Node/Express.
# Isso afeta req.ip (e portanto o rate-limit por IP).
# Exemplos:
# - 0 => app exposta diretamente (sem proxy)
# - 1 => Nginx/Traefik direto na frente do Node
# - 2 => Cloudflare -> Nginx -> Node
TRUST_PROXY=1

# =========================
# APP PUBLIC URL (prefixo dos links)
# =========================
# Base URL pública do app (sem barra no final)
APP_PUBLIC_URL=http://127.0.0.1:8080

# Endpoint de confirmação (rota GET)
EMAIL_CONFIRM_CONFIRM_ENDPOINT=/forward/confirm

# TTL do token (minutos)
EMAIL_CONFIRMATION_TTL_MINUTES=10

# Resend cooldown (segundos)
EMAIL_CONFIRMATION_RESEND_COOLDOWN_SECONDS=60

# Tamanho do token base62 (8..64 recomendado; default: 12)
EMAIL_CONFIRMATION_TOKEN_LEN=12

# Guardar request_ip "packed" em VARBINARY(16)
EMAIL_CONFIRM_STORE_IP_PACKED=true

# Token: validação de formato no endpoint /forward/confirm
EMAIL_CONFIRMATION_TOKEN_MIN_LEN=10
EMAIL_CONFIRMATION_TOKEN_MAX_LEN=24

# =========================
# SMTP (envio de e-mail)
# =========================
SMTP_HOST=
SMTP_PORT=587
SMTP_SECURE=false

# Se seu SMTP não exigir auth, você pode desabilitar
SMTP_AUTH_ENABLED=true
SMTP_USER=
SMTP_PASS=

# "From" que aparece no e-mail
SMTP_FROM="John Doe <john.doe@ccc.de>"

# (opcional) nome HELO/EHLO
SMTP_HELO_NAME=

# TLS (true recomendado; em dev você pode colocar false pra self-signed)
SMTP_TLS_REJECT_UNAUTHORIZED=true

# (opcional) subject padronizado
EMAIL_CONFIRMATION_SUBJECT="Confirm your email"

###############################################################################
# MARIADB (AUTH + CONNECTION)
###############################################################################
# Host do MariaDB (ex.: localhost, mariadb, 127.0.0.1)
MARIADB_HOST=

# Porta padrão do MariaDB
MARIADB_PORT=

# Usuário do MariaDB
MARIADB_USER=

# Senha do usuário do MariaDB
MARIADB_PASSWORD=

# Nome do banco de dados
MARIADB_DATABASE=

# (Opcional) Se você usa TLS/SSL no MariaDB:
# MARIADB_SSL=true
# MARIADB_SSL_CA_PATH=/path/to/ca.pem


###############################################################################
# REDIS (RATE LIMIT STORE - OPTIONAL)
###############################################################################
# Se REDIS_URL estiver vazio/não definido, o rate-limit usa MemoryStore (por instância).
# Para produção (multi-instância), recomendo habilitar.
#
# Exemplos:
# REDIS_URL=redis://:SENHA@127.0.0.1:6379/0
# REDIS_URL=redis://127.0.0.1:6379/0
REDIS_URL=

# (Opcional) Prefixo para as chaves do rate-limit no Redis
# Ajuda a organizar e evitar colisões com outras apps.
REDIS_RATE_LIMIT_PREFIX=rl:

# (Opcional) Timeout de conexão com Redis em ms
REDIS_CONNECT_TIMEOUT_MS=5000


###############################################################################
# CHECKDNS RELAY (DNS VALIDATION SERVICE)
###############################################################################
# Base URL do serviço check-dns (sem barra no final)
CHECKDNS_BASE_URL=http://localhost:3000

# Token enviado como header x-api-key
CHECKDNS_TOKEN=

# Timeout HTTP em ms (default: 8000)
CHECKDNS_HTTP_TIMEOUT_MS=8000


###############################################################################
# RATE LIMIT / SLOW DOWN (DEFAULTS)
# Esses valores alimentam diretamente o rate_limit.js via process.env
###############################################################################

# Global: limite genérico por IP para toda a aplicação
RL_GLOBAL_PER_MIN=300

# -----------------------------
# /forward/subscribe (request)
# -----------------------------

# Slow Down por IP: começa a atrasar após X req/min
SD_SUBSCRIBE_DELAY_AFTER=10

# Slow Down step: quanto aumenta o atraso por request acima do "delayAfter"
SD_SUBSCRIBE_DELAY_STEP_MS=250

# Hard Limit por IP: N requests por 10 minutos
RL_SUBSCRIBE_PER_10MIN_PER_IP=60

# Hard Limit por destino (to=...): N requests por hora por email destino
RL_SUBSCRIBE_PER_HOUR_PER_TO=6

# Hard Limit por alias (domain+name): N requests por hora por alias
RL_SUBSCRIBE_PER_HOUR_PER_ALIAS=20

# -----------------------------
# /forward/confirm (confirm)
# -----------------------------

# Confirm Hard Limit por IP: N requests por 10 min
RL_CONFIRM_PER_10MIN_PER_IP=120

# Confirm Hard Limit por token: N requests por 10 min por token
RL_CONFIRM_PER_10MIN_PER_TOKEN=10

# -----------------------------
# /forward/unsubscribe (request)
# -----------------------------

# Slow Down por IP no unsubscribe request
SD_UNSUBSCRIBE_DELAY_AFTER=8
SD_UNSUBSCRIBE_DELAY_STEP_MS=300

# Hard Limit por IP no unsubscribe request
RL_UNSUBSCRIBE_PER_10MIN_PER_IP=40

# Hard Limit por address (alias address): N requests por hora por address
RL_UNSUBSCRIBE_PER_HOUR_PER_ADDRESS=6

# -----------------------------
# /forward/unsubscribe/confirm
# -----------------------------

# Confirm Hard Limit por IP no unsubscribe confirm
RL_UNSUBSCRIBE_CONFIRM_PER_10MIN_PER_IP=120

# Confirm Hard Limit por token no unsubscribe confirm
RL_UNSUBSCRIBE_CONFIRM_PER_10MIN_PER_TOKEN=10

# Domínio padrão usado quando o usuário NÃO informa ?domain=
DEFAULT_ALIAS_DOMAIN=thc.org

# TTL do link/token de confirmação (minutos)
EMAIL_CONFIRMATION_TTL_MINUTES=10

EMAIL_CONFIRMATION_SUBJECT_SUBSCRIBE="Confirm alias creation"
EMAIL_CONFIRMATION_SUBJECT_UNSUBSCRIBE="Confirm alias removal"

###############################################################################
# API CREDENTIALS EMAIL
###############################################################################
API_CREDENTIALS_CONFIRM_ENDPOINT=/api/credentials/confirm
API_CREDENTIALS_EMAIL_TTL_MINUTES=15
API_CREDENTIALS_EMAIL_RESEND_COOLDOWN_SECONDS=60
API_CREDENTIALS_EMAIL_TOKEN_LEN=20
API_CREDENTIALS_EMAIL_SUBJECT="Your API token request"
